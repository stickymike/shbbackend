# Migration `20200318132753-first-up`

This migration has been generated by stickymike at 3/18/2020, 1:27:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
  "code" integer NOT NULL DEFAULT 0 ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text NOT NULL DEFAULT '' ,
  "firstName" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "lastName" text NOT NULL DEFAULT '' ,
  "password" text NOT NULL DEFAULT '' ,
  "title" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."PunchCard" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "punchIn" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "punchOut" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."TimeRole" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "payRate" integer NOT NULL DEFAULT 0 ,
  "shortName" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."TimeRequest" (
  "approved" boolean   ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "endTime" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "isAllDay" boolean NOT NULL DEFAULT false ,
  "reason" text NOT NULL DEFAULT '' ,
  "startTime" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."TaskGroup" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Task" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."User_permissions" (
  "nodeId" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE CASCADE,
  "position" integer NOT NULL  ,
  "value" text NOT NULL  ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "public"."_TimeRoleToUser" (
  "A" text NOT NULL  REFERENCES "public"."TimeRole"("id") ON DELETE CASCADE,
  "B" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE CASCADE
);

ALTER TABLE "public"."PunchCard" ADD COLUMN "timeRole" text NOT NULL  REFERENCES "public"."TimeRole"("id") ON DELETE RESTRICT,
ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."TimeRequest" ADD COLUMN "user" text NOT NULL  REFERENCES "public"."User"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Task" ADD COLUMN "parentTask" text NOT NULL  REFERENCES "public"."Task"("id") ON DELETE RESTRICT,
ADD COLUMN "taskGroup" text   REFERENCES "public"."TaskGroup"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "User.code" ON "public"."User"("code")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "_TimeRoleToUser_AB_unique" ON "public"."_TimeRoleToUser"("A","B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200318132753-first-up
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,96 @@
+
+datasource mysql {
+  provider = "mysql"
+  url      = "mysql://root:prisma@localhost:3306/prisma"
+  enabled  = false
+}
+
+generator photon {
+  provider = "photonjs"
+  // binaryTargets = ["native"]
+}
+
+datasource postgresql {
+  provider = "postgresql"
+  url      = "postgresql://ccyleywleafutj:a89e2a184f59f70bb6a5ddef9f042f4cd95934195c4c31f3054e72ea216deb33@ec2-54-221-225-11.compute-1.amazonaws.com:5432/d4v0s437vieiac?sslaccept=accept_invalid_certs"
+  enabled  = true
+
+}
+
+model User {
+  id          String        @default(cuid()) @id
+  code        Int           @unique
+  email       String        @unique
+  password    String
+  firstName   String
+  lastName    String
+  title       String?
+  createdAt   DateTime      @default(now())
+  updatedAt   DateTime      @updatedAt
+  // timeCards   TimeCard[]
+  timeRoles   TimeRole[]
+  punchCards  PunchCard[]
+  // group: [UserGroup]
+  permissions Permissions[]
+  events      TimeRequest[]
+}
+
+model PunchCard {
+  id        String   @default(cuid()) @id
+  user      User
+  punchIn   DateTime
+  punchOut  DateTime
+  timeRole  TimeRole
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
+model TimeRole {
+  id          String      @default(cuid()) @id
+  name        String
+  shortName   String
+  description String
+  payRate     Int
+  users       User[]
+  // timeCards   TimeCard[]
+  punchCards  PunchCard[]
+  updatedAt   DateTime    @updatedAt
+  createdAt   DateTime    @default(now())
+}
+
+enum Permissions {
+  ADMIN USER TIMECARDVIEWER TIMECARDEDITOR
+}
+
+enum Punchtype {
+  CLOCKIN CLOCKOUT
+}
+
+model TimeRequest {
+  id        String   @default(cuid()) @id
+  user      User
+  reason    String
+  approved  Boolean?
+  startTime DateTime
+  endTime   DateTime
+  isAllDay  Boolean  @default(false)
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
+model TaskGroup {
+  id        String   @default(cuid()) @id
+  name      String
+  tasks     Task[]
+  updatedAt DateTime @updatedAt
+  createdAt DateTime @default(now())
+}
+
+model Task {
+  id            String   @default(cuid()) @id
+  name          String
+  parentTask    Task     @relation(name: "newTaskCheck")
+  childrenTasks Task[]   @relation(name: "newTaskCheck")
+  updatedAt     DateTime @updatedAt
+  createdAt     DateTime @default(now())
+}
```


