# Migration `20191109111055-first`

This migration has been generated by stickymike at 11/9/2019, 11:10:55 AM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
  "code" integer NOT NULL DEFAULT 0 ,
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "email" text NOT NULL DEFAULT '' ,
  "firstName" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "lastName" text NOT NULL DEFAULT '' ,
  "password" text NOT NULL DEFAULT '' ,
  "title" text   ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."TimeCard" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "punchTime" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "punchType" text NOT NULL DEFAULT 'CLOCKIN' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."PunchCard" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text NOT NULL  ,
  "punchIn" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "punchOut" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."TimeRole" (
  "createdAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "description" text NOT NULL DEFAULT '' ,
  "id" text NOT NULL  ,
  "name" text NOT NULL DEFAULT '' ,
  "payRate" integer NOT NULL DEFAULT 0 ,
  "shortName" text NOT NULL DEFAULT '' ,
  "updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."User_permissions" (
  "nodeId" text   REFERENCES "public"."User"("id") ON DELETE CASCADE,
  "position" integer NOT NULL  ,
  "value" text NOT NULL  ,
  PRIMARY KEY ("nodeId","position")
);

CREATE TABLE "public"."_TimeRoleToUser" (
  "A" text   REFERENCES "public"."TimeRole"("id") ON DELETE CASCADE,
  "B" text   REFERENCES "public"."User"("id") ON DELETE CASCADE
);

ALTER TABLE "public"."TimeCard" ADD COLUMN "timeRole" text   REFERENCES "public"."TimeRole"("id") ON DELETE SET NULL,
ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

ALTER TABLE "public"."PunchCard" ADD COLUMN "timeRole" text   REFERENCES "public"."TimeRole"("id") ON DELETE SET NULL,
ADD COLUMN "user" text   REFERENCES "public"."User"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "User.id" ON "public"."User"("id")

CREATE UNIQUE INDEX "User.code" ON "public"."User"("code")

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "TimeCard.id" ON "public"."TimeCard"("id")

CREATE UNIQUE INDEX "PunchCard.id" ON "public"."PunchCard"("id")

CREATE UNIQUE INDEX "TimeRole.id" ON "public"."TimeRole"("id")

CREATE UNIQUE INDEX "_TimeRoleToUser_AB_unique" ON "public"."_TimeRoleToUser"("A","B")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191109111055-first
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,87 @@
+
+datasource mysql {
+  provider = "mysql"
+  url      = "mysql://root:prisma@localhost:3306/prisma"
+  enabled = false
+}
+datasource postgresql {
+  provider  = "postgresql"
+  url       = "postgresql://ccyleywleafutj:a89e2a184f59f70bb6a5ddef9f042f4cd95934195c4c31f3054e72ea216deb33@ec2-54-221-225-11.compute-1.amazonaws.com:5432/d4v0s437vieiac?ssl_accept=accept_invalid_certs;sslmode=prefer
+"
+
+  enabled = true
+
+}
+
+generator photon {
+  provider  = "photonjs"
+  binaryTargets = ["native"]
+}
+
+// generator nexus_prisma {
+//   provider = "nexus-prisma"
+// }
+
+
+model User {
+  id          String            @default(cuid()) @id @unique
+  code        Int               @unique
+  email       String            @unique
+  password    String
+  firstName   String
+  lastName    String
+  title       String?
+  createdAt   DateTime          @default(now())
+  updatedAt   DateTime          @updatedAt
+  timeCards   TimeCard[]
+  timeRoles   TimeRole[]
+  punchCards  PunchCard[]
+  // group: [UserGroup]
+  permissions Permissions[]
+
+}
+
+model TimeCard {
+  id          String      @default(cuid()) @id @unique
+  user        User
+  punchTime   DateTime
+  punchType   Punchtype
+  updatedAt   DateTime    @updatedAt
+  createdAt   DateTime    @default(now())
+  timeRole    TimeRole
+}
+
+model PunchCard {
+  id          String      @default(cuid()) @id @unique
+  user        User
+  punchIn     DateTime
+  punchOut    DateTime
+  timeRole    TimeRole
+  updatedAt   DateTime    @updatedAt
+  createdAt   DateTime    @default(now())
+}
+
+model TimeRole {
+  id          String        @default(cuid()) @id @unique
+  name        String
+  shortName   String
+  description String
+  payRate     Int
+  users       User[]
+  timeCards   TimeCard[]
+  punchCards  PunchCard[]
+  updatedAt   DateTime      @updatedAt
+  createdAt   DateTime      @default(now())
+}
+
+enum Permissions {
+  ADMIN
+  USER
+  TIMECARDVIEWER
+  TIMECARDEDITOR
+}
+
+enum Punchtype {
+  CLOCKIN
+  CLOCKOUT
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191109111055-first)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191109111055-first'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
