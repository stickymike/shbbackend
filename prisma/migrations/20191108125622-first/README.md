# Migration `20191108125622-first`

This migration has been generated by stickymike at 11/8/2019, 12:56:22 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `prisma`.`User` (
  `code` int NOT NULL DEFAULT 0 ,
  `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `email` varchar(191) NOT NULL DEFAULT '' ,
  `firstName` varchar(191) NOT NULL DEFAULT '' ,
  `id` varchar(191) NOT NULL  ,
  `lastName` varchar(191) NOT NULL DEFAULT '' ,
  `password` varchar(191) NOT NULL DEFAULT '' ,
  `title` varchar(191)   ,
  `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `prisma`.`TimeCard` (
  `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `id` varchar(191) NOT NULL  ,
  `punchTime` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `punchType` varchar(191) NOT NULL DEFAULT 'CLOCKIN' ,
  `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `prisma`.`PunchCard` (
  `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `id` varchar(191) NOT NULL  ,
  `punchIn` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `punchOut` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `prisma`.`TimeRole` (
  `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  `description` varchar(191) NOT NULL DEFAULT '' ,
  `id` varchar(191) NOT NULL  ,
  `name` varchar(191) NOT NULL DEFAULT '' ,
  `payRate` int NOT NULL DEFAULT 0 ,
  `shortName` varchar(191) NOT NULL DEFAULT '' ,
  `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  PRIMARY KEY (`id`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `prisma`.`User_permissions` (
  `nodeId` varchar(191)  ,
 FOREIGN KEY (`nodeId`) REFERENCES `prisma`.`User`(`id`) ON DELETE CASCADE,
  `position` int NOT NULL  ,
  `value` varchar(191) NOT NULL  ,
  PRIMARY KEY (`nodeId`,`position`)
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

CREATE TABLE `prisma`.`_TimeRoleToUser` (
  `A` varchar(191)  ,
 FOREIGN KEY (`A`) REFERENCES `prisma`.`TimeRole`(`id`) ON DELETE CASCADE,
  `B` varchar(191)  ,
 FOREIGN KEY (`B`) REFERENCES `prisma`.`User`(`id`) ON DELETE CASCADE
)
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

ALTER TABLE `prisma`.`TimeCard` ADD COLUMN `timeRole` varchar(191)  ,
ADD FOREIGN KEY (`timeRole`) REFERENCES `prisma`.`TimeRole`(`id`) ON DELETE SET NULL,
ADD COLUMN `user` varchar(191)  ,
ADD FOREIGN KEY (`user`) REFERENCES `prisma`.`User`(`id`) ON DELETE SET NULL;

ALTER TABLE `prisma`.`PunchCard` ADD COLUMN `timeRole` varchar(191)  ,
ADD FOREIGN KEY (`timeRole`) REFERENCES `prisma`.`TimeRole`(`id`) ON DELETE SET NULL,
ADD COLUMN `user` varchar(191)  ,
ADD FOREIGN KEY (`user`) REFERENCES `prisma`.`User`(`id`) ON DELETE SET NULL;

CREATE UNIQUE INDEX `User.id` ON `prisma`.`User`(`id`)

CREATE UNIQUE INDEX `User.code` ON `prisma`.`User`(`code`)

CREATE UNIQUE INDEX `User.email` ON `prisma`.`User`(`email`)

CREATE UNIQUE INDEX `TimeCard.id` ON `prisma`.`TimeCard`(`id`)

CREATE UNIQUE INDEX `PunchCard.id` ON `prisma`.`PunchCard`(`id`)

CREATE UNIQUE INDEX `TimeRole.id` ON `prisma`.`TimeRole`(`id`)

CREATE UNIQUE INDEX `_TimeRoleToUser_AB_unique` ON `prisma`.`_TimeRoleToUser`(`A`,`B`)
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20191108125622-first
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,85 @@
+
+datasource mysql {
+  provider = "mysql"
+  url      = "mysql://root:prisma@localhost:3306/prisma"
+  enabled = true
+}
+datasource postgresql {
+  provider  = "postgresql"
+  url       = "postgresql://postgres:secrect@localhost:5432/prisma"
+  enabled = false
+
+}
+
+generator photon {
+  provider  = "photonjs"
+  platforms = ["native"]
+}
+
+generator nexus_prisma {
+  provider = "nexus-prisma"
+}
+
+
+model User {
+  id          String            @default(cuid()) @id @unique
+  code        Int               @unique
+  email       String            @unique
+  password    String
+  firstName   String
+  lastName    String
+  title       String?
+  createdAt   DateTime          @default(now())
+  updatedAt   DateTime          @updatedAt
+  timeCards   TimeCard[]
+  timeRoles   TimeRole[]
+  punchCards  PunchCard[]
+  // group: [UserGroup]
+  permissions Permissions[]
+
+}
+
+model TimeCard {
+  id          String      @default(cuid()) @id @unique
+  user        User
+  punchTime   DateTime
+  punchType   Punchtype
+  updatedAt   DateTime    @updatedAt
+  createdAt   DateTime    @default(now())
+  timeRole    TimeRole
+}
+
+model PunchCard {
+  id          String      @default(cuid()) @id @unique
+  user        User
+  punchIn     DateTime
+  punchOut    DateTime
+  timeRole    TimeRole
+  updatedAt   DateTime    @updatedAt
+  createdAt   DateTime    @default(now())
+}
+
+model TimeRole {
+  id          String        @default(cuid()) @id @unique
+  name        String
+  shortName   String
+  description String
+  payRate     Int
+  users       User[]
+  timeCards   TimeCard[]
+  punchCards  PunchCard[]
+  updatedAt   DateTime      @updatedAt
+  createdAt   DateTime      @default(now())
+}
+
+enum Permissions {
+  ADMIN
+  USER
+  TIMECARDVIEWER
+  TIMECARDEDITOR
+}
+
+enum Punchtype {
+  CLOCKIN
+  CLOCKOUT
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20191108125622-first)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20191108125622-first'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
